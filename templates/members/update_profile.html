{% extends "base.html" %}
{% load static %}
{% block title %} Edit Profile {% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/update_profile.css' %}">

<form method="post" enctype="multipart/form-data">
  {% csrf_token %}
  {% if u_form.errors or p_form.errors %}
    <div class="form-errors">
      <ul>
        {% for field, errors in u_form.errors.items %}
          {% for error in errors %}
            <li>{{ field|capfirst }}: {{ error }}</li>
          {% endfor %}
        {% endfor %}
        {% for field, errors in p_form.errors.items %}
          {% for error in errors %}
            <li>{{ field|capfirst }}: {{ error }}</li>
          {% endfor %}
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  {{ p_form.user }}
  <div class="form-grid">
    <!-- User + Profile Card -->
    <div class="form-card">
      <label class="field">
        <span class="label">Profile Picture</span>

        <!-- Profile Pic Container -->
        <div id="profile-pic-container" style="position: relative; display: inline-block; width: 150px; height: 150px; cursor: pointer;">
  <!-- Profile Image -->
            {% if profile.profile_pic %}
  <img id="current-preview" src="{{ profile.profile_pic.url }}" alt="Profile Picture"
       style="width:100%; height:100%; border-radius:50%; object-fit:cover; transition: transform 0.3s;">
            {% else %}
                <img id="current-preview" src="{% static 'images/default_pic.png' %}" alt="Profile Picture"
       style="width:100%; height:100%; border-radius:50%; object-fit:cover; transition: transform 0.3s;">
            {% endif %}

  <!-- Click overlay (centered) -->
  <div style="
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 30%;
    text-align: center;
    background: rgba(0,0,0,0.5);
    color: white;
    font-size: 14px;
    line-height: 30px;
    border-bottom-left-radius:50%;
    border-bottom-right-radius:50%;
  ">
    Click to change
  </div>


  <input type="file" id="profileInput" name="profile_pic" accept="image/*" style="display:none;">
</div>

      </label>

      <label class="field">
        <span class="label">First Name</span>
        {{ u_form.first_name }}
      </label>

      <label class="field">
        <span class="label">Last Name</span>
        {{ u_form.last_name }}
      </label>

      <label class="field">
        <span class="label">Bio</span>
        {{ p_form.bio }}
      </label>
    </div>

    <!-- Social Links Card -->
    <div class="form-card">
      <h2>Social Links</h2>

      <label class="field">
        <span class="label">Instagram</span>
        {{ p_form.inst }}
      </label>

      <label class="field">
        <span class="label">Twitter</span>
        {{ p_form.twitter }}
      </label>

      <label class="field">
        <span class="label">Facebook</span>
        {{ p_form.facebook }}
      </label>
    </div>
  </div>

  <button type="submit" class="sticky-save-btn">ðŸ’¾ Save Changes</button>
</form>

<script>
const profilePic = document.getElementById('current-preview');
const profileInput = document.getElementById('profileInput');
const arrow = document.getElementById('arrow');

// Click profile pic opens file picker
profilePic.addEventListener('click', () => profileInput.click());

// Preview new image and show arrow
profileInput.addEventListener('change', () => {
  const file = profileInput.files[0];
  if (file && file.type.startsWith('image/')) {
    const reader = new FileReader();
    reader.onload = (e) => {
      profilePic.src = e.target.result;

      // Show arrow with transition
      arrow.style.opacity = 1;
      arrow.style.right = '0px';
    };
    reader.readAsDataURL(file);
  }

});
</script>

{% endblock %}
