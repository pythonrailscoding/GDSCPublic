{% extends 'base.html' %}
{% load static %}

{% block title %} Update Blog {% endblock %}

{% block content %}
    <style>
        /* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-content {
  background: #1c2333;
  padding: 2rem;
  border-radius: 10px;
  text-align: center;
  max-width: 400px;
  width: 90%;
}
.cancel-btn {
  background: #555;
  color: white;
  padding: 0.6rem 1.2rem;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

.modal-actions {
  margin-top: 1.5rem;
  display: flex;
  justify-content: center;
  gap: 1rem;
}
    </style>
    <link rel="stylesheet" href="{% static 'css/create.css' %}">
    <link rel="stylesheet" href="{% static 'css/alert.css' %}">
    <div class="wrap">
    <form class="card" method="post" enctype="multipart/form-data">
      {% csrf_token %}
    {{ form.user }}
    {{ form.media }}
      <h1 class="title">Update your blog!</h1>
    {% if form.errors %}
  <div class="alert" id="alertBox">
    <span class="alert-message">
      Please correct the following errors:
      <ul>
        {% for field, errors in form.errors.items %}
          {% for error in errors %}
            <li><strong>{{ field|title }}:</strong> {{ error }}</li>
          {% endfor %}
        {% endfor %}
      </ul>
    </span>
    <button class="alert-close" onclick="dismissAlert()">√ó</button>
  </div>
{% endif %}


      <label class="field" for="{{ form.title.id_for_label }}">
        <span class="label">Title</span>
        {{ form.title }}
        <span class="hint">Keep it short and descriptive.</span>
        {% if form.title.errors %}<div class="error">{{ form.title.errors }}</div>{% endif %}
      </label>


      <label class="field">
        <span class="label">Description</span>
        {{ form.content }}
      </label>

      <label class="field">
  <span class="label">Thumbnail</span>
  <div class="filebox" id="dropzone">
    {{ form.thumbnail }}
    <div class="file-ui">
      <div class="icon">üñºÔ∏è</div>
      <div class="text">
        <strong>Click to choose</strong> or drag & drop
        <div class="sub">All files supported* up to 100 MB</div>
      </div>
    </div>


    {% if form.instance and form.instance.thumbnail %}
      <img src="{{ form.instance.thumbnail.url }}" class="preview" id="preview" alt="Thumbnail Preview">
    {% else %}
      <img src="" class="preview" id="preview" alt="Thumbnail Preview" style="display: none;">
    {% endif %}
  </div>
  {% if form.thumbnail.errors %}
    <div class="error">{{ form.thumbnail.errors }}</div>
  {% endif %}
</label>
    <p style="cursor: pointer; align-items: center" onclick="openDeleteModal()">*View unsupported file extensions</p>

      <button class="btn" type="submit">Update!</button>
    </form>
  </div>
    <div id="deleteModal" class="modal">
  <div class="modal-content">
    <p>Unsupported extensions: '.tif', '.tiff', '.heif', '.heic', '.raw', '.psd', '.ai', '.eps', '.indd', '.pdf', '.xcf', '.jp2'</p>
    <div class="modal-actions">
        <button class="cancel-btn" onclick="closeDeleteModal()">Close</button>
    </div>
  </div>
</div>
    <script>
    const name = "{{ request.user.id }}";
	document.getElementById('userid').value = name;
    </script>
    <script>
    const input = document.getElementById("image");
const preview = document.getElementById("preview");
const dropzone = document.getElementById("dropzone");

function showPreview(file) {
  if (!file || !file.type.startsWith("image/")) return;
  const url = URL.createObjectURL(file);
  preview.src = url;
  preview.style.display = "block";
  dropzone.classList.add("has-preview");
}

if (input) {
  input.addEventListener("change", e => showPreview(e.target.files[0]));
}

// Drag & Drop
["dragenter", "dragover"].forEach(ev =>
  dropzone.addEventListener(ev, e => {
    e.preventDefault();
    dropzone.classList.add("drag");
  })
);
["dragleave", "drop"].forEach(ev =>
  dropzone.addEventListener(ev, e => {
    e.preventDefault();
    dropzone.classList.remove("drag");
  })
);

dropzone.addEventListener("drop", e => {
  const file = e.dataTransfer.files[0];
  if (file) {
    input.files = e.dataTransfer.files;
    showPreview(file);
  }
});

// On page load, show existing thumbnail (for update blog case)
window.addEventListener("DOMContentLoaded", () => {
  if (preview && preview.src && preview.src.trim() !== "" && !preview.src.includes("placeholder")) {
    preview.style.display = "block";
    dropzone.classList.add("has-preview");
  }
});
function openDeleteModal() {
  document.getElementById("deleteModal").style.display = "flex";
}

function closeDeleteModal() {
  document.getElementById("deleteModal").style.display = "none";
}
</script>

    </script>
{% endblock %}



